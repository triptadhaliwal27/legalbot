<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!DOCTYPE html>
<html>
	<head>
		<title>LegallyBot</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}"/>
	</head>
	
	
	<body>
		<div class="container-fluid h-100">
			<div class="row justify-content-center h-100">		
				<div class="col-md-8 col-xl-6 chat">
					<div class="card">
						<div class="card-header msg_head">
							<div class="d-flex bd-highlight">
								<div class="img_cont">
									<img src="https://i.ibb.co/fSNP7Rz/icons8-chatgpt-512.png" class="rounded-circle user_img">
									<span class="online_icon"></span>
								</div>
								<div class="user_info">
									<span>LegallyBot</span>
									<p>Ask me anything!</p>
								</div>
							</div>
						</div>
						<div id="message-container" class="card-body msg_card_body">
							
							
						</div>
						<div class="card-footer">
							<form id="messageArea" class="input-group">
                                <input type="text" id="text" name="msg" placeholder="Type your message..." autocomplete="off" class="form-control type_msg" required/>
								<div class="input-group-append">
									<button type="submit" id="send" class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
        </div>
        
        <script>
                $(document).ready(function() {
                    $('#messageArea').on("submit", function(event) {
                        event.preventDefault(); //prevent page reload on submit

                        const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})
                        var userText = $("#text").val()
                        var state = $('#state').val();

                        if (userText) {
                            //append user message to chat container
                            const userHtml = `
                            <div class="d-flex justify-content-end mb-4">
                                <div class="msg_cotainer_send">${userText}<span class="msg_time_send">${timestamp}</span></div>
                                <div class="img_cont_msg">
                                    <img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg">
                                </div>
                            </div>`;
                            $('#message-container').append(userHtml);

                            //send ajax request to the flask backend
                            $.ajax({
                                data: {
                                    msg: userText, state: state
                                },
                                type: 'POST',
                                url: "/get",
                                success: function(response) {
                                    //append the bot's responsew to chat container
                                    const botHtml = `
                                    <div class="d-flex justify-content-start mb-4">
                                        <div class="img_cont_msg">
                                            <img src="https://i.ibb.co/fSNP7Rz/icons8-chatgpt-512.png" class="rounded-circle user_img_msg">
                                        </div>
                                        <div class="msg_cotainer">${response.response}<span class="msg_time">${timestamp}</span></div>
                                    </div>`;
                                    $('#message-container').append(botHtml);
                                    //scroll to bottom of chat container
                                    $('message-container').scrollTop($('#message-container'[0].scrollHeight))
                                },
                                error: function(xhr) {
                                    //apend error message to chat container
                                    const errorHtml = `
                                    <div class="d-flex justify-content-start mb-4">
                                        <div class="msg_cotainer">Error: ${xhr.responseText || "An error occurred."}
                                        <span class="msg_time">${timestamp}</span></div>
                                    </div>`;
                                $('#message-container').append(errorHtml);
                                }
                            });
                            //clear input field after sending message
                            $('#text').val()
                        } else {
                            alert("Please enter a message before sending")
                        }
                    });

                    //allow Enter to trigger form submission
                    $('#text').on('keypress', function (e) {
                        if (e.which === 13) {
                            $('#messageArea').submit();
                        }
                    });
                });
        </script>
    </body>
</html>